<link
	rel="icon"
	type="image/bmp"
	href="favicon.bmp" />
<script src="spark-md5.min.js"></script>
<script>
	function getarg() {
		let a = window.location.search.substring(1).split("&");
		let c = {};
		a.forEach(function (e) {
			let b = e.split("=");
			c[b[0]] = b[1];
		});
		return c;
	}
	function getid() {
		return $.ajax({
			url: "https://gitee.com/api/v5/repos/zyc-2024/chat/raw/private/id.json",
			crossDomain: true,
			contentType: "application/json;charset=UTF-8",
			data: {
				access_token: "19f7b43872c256d52d1bc71cbd2d0ffa",
			},
		}).done(function (response) {
			return response;
		});
	}
	function addid() {
		var id = getid();
		$.get(
			"https://gitee.com/api/v5/repos/zyc-2024/chat/contents/private%2Fid.json",
			{
				access_token: "19f7b43872c256d52d1bc71cbd2d0ffa",
			}
		).done(function (response) {
			var sha = response.sha;
			$.ajax({
				url: "https://gitee.com/api/v5/repos/zyc-2024/chat/contents/private%2Fid.json",
				crossDomain: true,
				method: "PUT",
				contentType: "application/json;charset=UTF-8",
				data: JSON.stringify({
					access_token: "19f7b43872c256d52d1bc71cbd2d0ffa",
					content: Base64.encode(String(id + 1)),
					sha: sha,
					message: "id add 1",
				}),
			}).done(function (response) {
				return;
			});
		});
	}
	function getkey() {
		return SparkMD5.hash(String(getid()) + String(getarg().key));
	}
	if (
		(getarg().type != "r" && getarg().type != "u") ||
		(getarg().type == "r" && !getarg().key) ||
		(getarg().type == "u" && !getarg().ch)
	) {
		document.body.innerHTML = "Error! 你确定这不是你输错了？";
	} else if (getarg().type == "u") {
		$.ajax({
			url: "https://gitee.com/api/v5/repos/zyc-2024/chat/raw/public/index.json",
			crossDomain: true,
			contentType: "application/json;charset=UTF-8",
			data: {
				access_token: "19f7b43872c256d52d1bc71cbd2d0ffa",
			},
		}).done(function (response) {
			r = JSON.parse(response);
			r.ch[r.ch.length] = getarg().ch;
			$.get(
				"https://gitee.com/api/v5/repos/zyc-2024/chat/contents/public%2Fmsg%2F" +
					ch +
					".json",
				{
					access_token: "19f7b43872c256d52d1bc71cbd2d0ffa",
				}
			).done(function (response) {
				sha = response.sha;
				var t = new Date();
				$.ajax({
					url: "https://gitee.com/api/v5/repos/zyc-2024/chat/contents/public%2Findex.json",
					crossDomain: true,
					method: "PUT",
					contentType: "application/json;charset=UTF-8",
					data: JSON.stringify({
						access_token: "19f7b43872c256d52d1bc71cbd2d0ffa",
						content: Base64.encode(JSON.stringify(r)),
						sha: sha,
						message: "update index",
					}),
				}).done(function (response) {
					$.ajax({
						url:
							"https://gitee.com/api/v5/repos/zyc-2024/chat/contents/public%2Fmsg%2F" +
							getarg().ch +
							".json",
						crossDomain: true,
						method: "post",
						contentType: "application/json;charset=UTF-8",
						data: JSON.stringify({
							access_token: "19f7b43872c256d52d1bc71cbd2d0ffa",
							content: Base64.encode("This channel was created!"),
							message: "initial[" + getarg().ch + "]",
						}),
					}).done(function (response) {
						window.location.href = "public.html?ch=" + getarg().ch;
					});
				});
			});
		});
	} else {
		$.ajax({
			url:
				"https://gitee.com/api/v5/repos/zyc-2024/chat/contents/private%2Fmsg%2F" +
				getarg().ch +
				".json",
			crossDomain: true,
			method: "post",
			contentType: "application/json;charset=UTF-8",
			data: JSON.stringify({
				access_token: "19f7b43872c256d52d1bc71cbd2d0ffa",
				content: Base64.encode("This channel was created!"),
				message: "initial[" + getarg().ch + "]",
			}),
		}).done(function (response) {
			window.location.href = "public.html?ch=" + getarg().ch;
		});
	}
</script>
